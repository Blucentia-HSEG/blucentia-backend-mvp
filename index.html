<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSEG Cultural Risk Assessment | HSEG Lab</title>

    <!-- Modern CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Enterprise CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Cultural Risk Assessment Platform...</div>
            <div class="loading-progress">
                <div class="progress">
                    <div id="loadingProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-wrapper">
        <!-- Enhanced Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <i class="fas fa-chart-line brand-icon"></i>
                    <span class="brand-text">HSEG Lab</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Quick Stats Card -->
                <div class="sidebar-card">
                    <div class="sidebar-card-header">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>System Status</span>
                    </div>
                    <div class="sidebar-card-body">
                        <div class="stat-item">
                            <span class="stat-label">Data Freshness</span>
                            <span class="stat-value" id="dataFreshness">Live</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Response Time</span>
                            <span class="stat-value" id="responseTime">--ms</span>
                        </div>
                    </div>
                </div>

                <!-- Navigation Menu -->
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-home nav-icon"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#analytics" class="nav-link" data-section="analytics">
                            <i class="fas fa-chart-bar nav-icon"></i>
                            <span class="nav-text">Core Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#organizations" class="nav-link" data-section="organizations">
                            <i class="fas fa-building nav-icon"></i>
                            <span class="nav-text">Organizations</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#demographics" class="nav-link" data-section="demographics">
                            <i class="fas fa-users nav-icon"></i>
                            <span class="nav-text">Demographics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#advanced" class="nav-link" data-section="advanced">
                            <i class="fas fa-brain nav-icon"></i>
                            <span class="nav-text">Advanced Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#network" class="nav-link" data-section="network">
                            <i class="fas fa-network-wired nav-icon"></i>
                            <span class="nav-text">Network Analysis</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Top Navigation Bar -->
            <header class="top-nav">
                <div class="top-nav-left">
                    <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title" id="pageTitle">HSEG Cultural Risk Assessment</h1>
                </div>

                <div class="top-nav-right">
                    <div class="nav-controls">
                        <button class="btn btn-outline-primary btn-sm" id="refreshData">
                            <i class="fas fa-sync-alt"></i>
                            <span class="d-none d-md-inline">Refresh</span>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" id="exportData">
                            <i class="fas fa-download"></i>
                            <span class="d-none d-md-inline">Export</span>
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-cog"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-palette me-2"></i>Theme</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-sliders-h me-2"></i>Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-question-circle me-2"></i>Help</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Container -->
            <div class="content-container" id="contentContainer">

                <!-- Dashboard Section -->
                <section id="dashboard-section" class="content-section active">
                    <!-- KPI Cards -->
                    <div class="row g-3 mb-4" id="kpiCards">
                        <!-- KPI cards will be dynamically generated -->
                    </div>

                    <!-- Charts Row -->
                    <div class="row g-3 mb-4">
                        <div class="col-xl-8">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5 class="chart-title">Culture Score Trends</h5>
                                    <div class="chart-controls">
                                        <select class="form-select form-select-sm" id="trendTimeRange">
                                            <option value="7d">Last 7 Days</option>
                                            <option value="30d" selected>Last 30 Days</option>
                                            <option value="90d">Last 90 Days</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="chart-body">
                                    <canvas id="trendChart" style="height: 450px;"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5 class="chart-title">Domain Distribution</h5>
                                </div>
                                <div class="chart-body">
                                    <canvas id="domainPieChart" style="height: 450px;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="data-table-card">
                        <div class="table-header">
                            <h5 class="table-title">Recent Responses</h5>
                            <div class="table-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="form-control" placeholder="Search responses..." id="dataSearch">
                                </div>
                                <select class="form-select" id="tableFilter">
                                    <option value="all">All Organizations</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-body">
                            <div id="dataTableContainer">
                                <!-- Virtual table will be rendered here -->
                            </div>
                            <div class="table-pagination" id="tablePagination">
                                <!-- Pagination controls -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics-section" class="content-section">
                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs section-tabs mb-4" id="analyticsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="sections-tab" data-bs-toggle="tab" data-bs-target="#sections" type="button" role="tab">
                                <i class="fas fa-chart-radar me-2"></i>Section Analysis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="trends-tab" data-bs-toggle="tab" data-bs-target="#trends" type="button" role="tab">
                                <i class="fas fa-chart-line me-2"></i>Trends
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="distributions-tab" data-bs-toggle="tab" data-bs-target="#distributions" type="button" role="tab">
                                <i class="fas fa-chart-histogram me-2"></i>Distributions
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button" role="tab">
                                <i class="fas fa-lightbulb me-2"></i>Insights
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content section-tab-content" id="analyticsTabContent">
                        <!-- Section Analysis Tab -->
                        <div class="tab-pane fade show active" id="sections" role="tabpanel">
                            <div class="row g-3">
                                <!-- Section Analysis Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Section Analysis Filters</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-4">
                                                    <label class="form-label">Organization</label>
                                                    <select class="form-select" id="sectionOrgFilter">
                                                        <option value="all" selected>All Organizations</option>
                                                    </select>
                                                    <select class="form-select mt-2" id="sectionOrgMulti" multiple style="display:none; min-height: 120px;"></select>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label">Chart Type</label>
                                                    <select class="form-select" id="sectionChartType">
                                                        <option value="radar" selected>Radar Chart</option>
                                                        <option value="bar">Bar Chart</option>
                                                        <option value="horizontal">Horizontal Bar</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Comparison Mode</label>
                                                    <select class="form-select" id="sectionComparisonMode">
                                                        <option value="single" selected>Single View</option>
                                                        <option value="multi">Multi-Organization</option>
                                                        <option value="benchmark">vs Benchmark</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Scoring Mode</label>
                                                    <select class="form-select" id="sectionScoringMode">
                                                        <option value="raw" selected>Raw Scores (1-4)</option>
                                                        <option value="weighted">HSEG Weighted</option>
                                                        <option value="percentage">% of Category Max</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section Radar Chart -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Section Performance Analysis</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="sectionRadarChart" style="height: 500px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Trends Tab -->
                        <div class="tab-pane fade" id="trends" role="tabpanel">
                            <div class="row g-3">
                                <!-- Trends Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Trend Analysis</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-3">
                                                    <label class="form-label">Time Range</label>
                                                    <select class="form-select" id="analyticsTrendTimeRange">
                                                        <option value="7d">Last 7 Days</option>
                                                        <option value="30d" selected>Last 30 Days</option>
                                                        <option value="90d">Last 90 Days</option>
                                                        <option value="1y">Last Year</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Metric</label>
                                                    <select class="form-select" id="analyticsTrendMetric">
                                                        <option value="culture_score" selected>Culture Score</option>
                                                        <option value="response_count">Response Volume</option>
                                                        <option value="section_scores">Section Scores</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Granularity</label>
                                                    <select class="form-select" id="analyticsTrendGranularity">
                                                        <option value="daily">Daily</option>
                                                        <option value="weekly" selected>Weekly</option>
                                                        <option value="monthly">Monthly</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Smoothing</label>
                                                    <select class="form-select" id="analyticsTrendSmoothing">
                                                        <option value="none">None</option>
                                                        <option value="ma7" selected>7-day MA</option>
                                                        <option value="ma30">30-day MA</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Trend Chart -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Culture Score Trends</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="analyticsTrendChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Distributions Tab -->
                        <div class="tab-pane fade" id="distributions" role="tabpanel">
                            <div class="row g-3">
                                <!-- Distribution Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Distribution Analysis</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Distribution Type</label>
                                                    <select class="form-select" id="distributionType">
                                                        <option value="scores" selected>Score Distribution</option>
                                                        <option value="responses">Response Distribution</option>
                                                        <option value="sections">Section Distribution</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Bin Size</label>
                                                    <select class="form-select" id="distributionBins">
                                                        <option value="10">10 bins</option>
                                                        <option value="20" selected>20 bins</option>
                                                        <option value="50">50 bins</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Distribution Chart -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Score Distribution Analysis</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="distributionChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Insights Tab -->
                        <div class="tab-pane fade" id="insights" role="tabpanel">
                            <div class="row g-3">
                                <!-- Statistical Insights -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Statistical Insights</h5>
                                        </div>
                                        <div class="chart-body">
                                            <div id="statisticalInsights">
                                                <!-- Dynamic insights will be generated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Organizations Section -->
                <section id="organizations-section" class="content-section">
                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs section-tabs mb-4" id="organizationTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="benchmark-tab" data-bs-toggle="tab" data-bs-target="#benchmark" type="button" role="tab">
                                <i class="fas fa-chart-bar me-2"></i>Benchmarking
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab">
                                <i class="fas fa-trophy me-2"></i>Performance
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="distribution-tab" data-bs-toggle="tab" data-bs-target="#distribution" type="button" role="tab">
                                <i class="fas fa-chart-pie me-2"></i>Distribution
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison" type="button" role="tab">
                                <i class="fas fa-balance-scale me-2"></i>Comparison
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content section-tab-content" id="organizationTabContent">
                        <!-- Benchmarking Tab -->
                        <div class="tab-pane fade show active" id="benchmark" role="tabpanel">
                            <div class="row g-3">
                                <!-- Global Filters for Benchmarking -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Advanced Filters</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-3">
                                                    <label class="form-label">Minimum Responses</label>
                                                    <select class="form-select" id="orgMinResponses">
                                                        <option value="10">Min 10 responses</option>
                                                        <option value="20" selected>Min 20 responses</option>
                                                        <option value="50">Min 50 responses</option>
                                                        <option value="100">Min 100 responses</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Domain Filter</label>
                                                    <select class="form-select" id="orgDomainFilter">
                                                        <option value="all">All Domains</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Score Range</label>
                                                    <select class="form-select" id="scoreRange">
                                                        <option value="all">All Tiers</option>
                                                        <option value="high">High (Safe + Thriving: 21-28)</option>
                                                        <option value="medium">Medium (Mixed: 17-20)</option>
                                                        <option value="low">Low (Crisis + At Risk: 7-16)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Organization Size</label>
                                                    <select class="form-select" id="orgSizeFilter">
                                                        <option value="all">All Sizes</option>
                                                        <option value="large">Large (500+)</option>
                                                        <option value="medium">Medium (100-500)</option>
                                                        <option value="small">Small (<100)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Organizational Benchmarking Matrix -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Organizational Benchmarking Matrix</h5>
                                            <div class="chart-controls">
                                                <button class="btn btn-outline-primary btn-sm" id="exportBenchmark">
                                                    <i class="fas fa-download me-1"></i>Export
                                                </button>
                                            </div>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="orgBenchmarkChart" style="height: 500px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Tab -->
                        <div class="tab-pane fade" id="performance" role="tabpanel">
                            <div class="row g-3">
                                <!-- Performance Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Performance Filters</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-4">
                                                    <label class="form-label">Sort By</label>
                                                    <select class="form-select" id="orgSortBy">
                                                        <option value="culture_score" selected>Culture Score</option>
                                                        <option value="response_count">Response Count</option>
                                                        <option value="score_std">Score Consistency</option>
                                                        <option value="improvement">Improvement Rate</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label">Time Period</label>
                                                    <select class="form-select" id="performanceTimeRange">
                                                        <option value="all" selected>All Time</option>
                                                        <option value="recent">Recent (Last 6 months)</option>
                                                        <option value="last_year">Last Year</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label">Show Top</label>
                                                    <select class="form-select" id="topOrgCount">
                                                        <option value="10">Top 10</option>
                                                        <option value="15" selected>Top 15</option>
                                                        <option value="20">Top 20</option>
                                                        <option value="all">All Organizations</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Organization Performance Scatter -->
                                <div class="col-xl-8">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Culture Score vs Response Volume</h5>
                                            <div class="chart-controls">
                                                <small class="text-muted">Bubble size = Employee Count</small>
                                            </div>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="orgScatterChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Top Organizations Performance -->
                                <div class="col-xl-4">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Top Organizations</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="topOrgsChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Distribution Tab -->
                        <div class="tab-pane fade" id="distribution" role="tabpanel">
                            <div class="row g-3">
                                <!-- Distribution Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Distribution Analysis</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Group By</label>
                                                    <select class="form-select" id="distributionGroupBy">
                                                        <option value="domain" selected>Domain</option>
                                                        <option value="size">Organization Size</option>
                                                        <option value="location">Location</option>
                                                        <option value="industry">Industry</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Metric</label>
                                                    <select class="form-select" id="distributionMetric">
                                                        <option value="count" selected>Count</option>
                                                        <option value="avg_score">Average Score</option>
                                                        <option value="total_responses">Total Responses</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Organizational Size Distribution -->
                                <div class="col-xl-6">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Organization Size Distribution</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="orgSizeChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Department Performance within Organizations -->
                                <div class="col-xl-6">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Department Performance Analysis</h5>
                                            <div class="chart-controls">
                                                <select class="form-select form-select-sm" id="selectedOrganization">
                                                    <option value="all">All Organizations</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="deptPerformanceChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <!-- Org Deep Dive: Departments and Positions -->
                                <div class="col-xl-6">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Department Distribution</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="deptPieChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-6">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Position Level Distribution</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="positionPieChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Comparison Tab -->
                        <div class="tab-pane fade" id="comparison" role="tabpanel">
                            <div class="row g-3">
                                <!-- Comparison Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Organization Comparison</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-3">
                                                    <label class="form-label">Organization 1</label>
                                                    <select class="form-select" id="radarOrg1">
                                                        <option value="">Select Organization 1</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Organization 2</label>
                                                    <select class="form-select" id="radarOrg2">
                                                        <option value="">Select Organization 2</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Organization 3</label>
                                                    <select class="form-select" id="radarOrg3">
                                                        <option value="">Select Organization 3</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Comparison Metric</label>
                                                    <select class="form-select" id="comparisonMetric">
                                                        <option value="sections" selected>Section Scores</option>
                                                        <option value="departments">Department Breakdown</option>
                                                        <option value="demographics">Demographics</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Organizational Radar Comparison -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Multi-Organization Radar Comparison</h5>
                                            <div class="chart-controls">
                                                <button class="btn btn-outline-primary btn-sm" id="resetComparison">
                                                    <i class="fas fa-undo me-1"></i>Reset
                                                </button>
                                            </div>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="orgRadarChart" style="height: 500px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Demographics Section -->
                <section id="demographics-section" class="content-section">
                    <div class="demographics-container" id="demographicsContainer">
                        <!-- Demographics content will be dynamically generated -->
                    </div>
                </section>



                <!-- Advanced Analytics Section -->
                <section id="advanced-section" class="content-section">
                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs section-tabs mb-4" id="advancedTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pca-tab" data-bs-toggle="tab" data-bs-target="#pca" type="button" role="tab">
                                <i class="fas fa-atom me-2"></i>PCA Analysis
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="clustering-tab" data-bs-toggle="tab" data-bs-target="#clustering" type="button" role="tab">
                                <i class="fas fa-layer-group me-2"></i>Clustering
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="hierarchical-tab" data-bs-toggle="tab" data-bs-target="#hierarchical" type="button" role="tab">
                                <i class="fas fa-sitemap me-2"></i>Hierarchical
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content section-tab-content" id="advancedTabContent">
                        <!-- PCA Analysis Tab -->
                        <div class="tab-pane fade show active" id="pca" role="tabpanel">
                            <div class="row g-3">
                                <!-- PCA Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>PCA Configuration</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-4">
                                                    <label class="form-label" for="pcaComponents">Components</label>
                                                    <select class="form-select" id="pcaComponents">
                                                        <option value="2" selected>2 Components</option>
                                                        <option value="3">3 Components</option>
                                                        <option value="5">5 Components</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label" for="pcaFeatures">Feature Selection</label>
                                                    <select class="form-select" id="pcaFeatures">
                                                        <option value="all" selected>All Questions</option>
                                                        <option value="sections">Section Averages</option>
                                                        <option value="top_variance">High Variance Only</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label" for="pcaScaling">Scaling</label>
                                                    <select class="form-select" id="pcaScaling">
                                                        <option value="standard" selected>StandardScaler</option>
                                                        <option value="minmax">MinMaxScaler</option>
                                                        <option value="robust">RobustScaler</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- PCA Charts -->
                                <div class="col-xl-8">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Principal Component Analysis (PCA)</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="pcaChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- HSEG Tier Distribution -->
                                <div class="col-xl-4">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">HSEG Risk Profile</h5>
                                            <p class="text-muted small mb-0">Distribution across cultural risk tiers</p>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="varianceChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <!-- PC Loadings -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">PC1 / PC2 Loadings (Top Features)</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="pcaLoadingsChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Clustering Tab -->
                        <div class="tab-pane fade" id="clustering" role="tabpanel">
                            <div class="row g-3">
                                <!-- Clustering Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Clustering Configuration</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-3">
                                                    <label class="form-label" for="clusteringAlgorithm">Algorithm</label>
                                                    <select class="form-select" id="clusteringAlgorithm">
                                                        <option value="kmeans" selected>K-Means</option>
                                                        <option value="hierarchical">Hierarchical</option>
                                                        <option value="dbscan">DBSCAN</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label" for="clusterCount">Number of Clusters</label>
                                                    <select class="form-select" id="clusterCount">
                                                        <option value="3">3 Clusters</option>
                                                        <option value="4" selected>4 Clusters</option>
                                                        <option value="5">5 Clusters</option>
                                                        <option value="auto">Auto-detect</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label" for="clusterMetric">Distance Metric</label>
                                                    <select class="form-select" id="clusterMetric">
                                                        <option value="euclidean" selected>Euclidean</option>
                                                        <option value="manhattan">Manhattan</option>
                                                        <option value="cosine">Cosine</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label" for="clusterBy">Cluster By</label>
                                                    <select class="form-select" id="clusterBy">
                                                        <option value="organization" selected>Organization</option>
                                                        <option value="response">Individual Response</option>
                                                        <option value="section">Section Scores</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Clustering Chart -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">K-Means Elbow Analysis</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="clusteringChart" style="height: 500px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Hierarchical Tab -->
                        <div class="tab-pane fade" id="hierarchical" role="tabpanel">
                            <div class="row g-3">
                                <!-- Hierarchical Filters -->
                                <div class="col-12">
                                    <div class="filter-card">
                                        <div class="filter-header">
                                            <h6><i class="fas fa-filter me-2"></i>Hierarchical Analysis</h6>
                                        </div>
                                        <div class="filter-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Visualization Type</label>
                                                    <select class="form-select" id="hierarchicalType">
                                                        <option value="treemap" selected>Treemap</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Demographic Focus</label>
                                                    <select class="form-select" id="demographicType">
                                                        <option value="tenure">Tenure Analysis</option>
                                                        <option value="position_level" selected>Position Level</option>
                                                        <option value="age_range">Age Range</option>
                                                        <option value="gender_identity">Gender Identity</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Min Responses</label>
                                                    <select class="form-select" id="hierarchicalMinResponses">
                                                        <option value="3">3+</option>
                                                        <option value="5" selected>5+</option>
                                                        <option value="10">10+</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Domain</label>
                                                    <select class="form-select" id="hierarchicalDomain">
                                                        <option value="all" selected>All Domains</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Ridge Plot Bins</label>
                                                    <select class="form-select" id="ridgeBins">
                                                        <option value="20">20 bins</option>
                                                        <option value="30" selected>30 bins</option>
                                                        <option value="40">40 bins</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hierarchical Visualization -->
                                <div class="col-xl-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Organizational Hierarchy</h5>
                                        </div>
                                        <div class="chart-body">
                                            <!-- Treemap Chart -->
                                            <div id="treemapChart" style="height: 400px;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ridge Plot (6.1) -->
                                <div class="col-12">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Ridge Plots for Section Distributions (6.1)</h5>
                                        </div>
                                        <div class="chart-body">
                                            <div id="ridgePlot" style="height: 600px;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ridge-like Distribution Comparisons -->
                                <div class="col-xl-4">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Section Distribution</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="ridgeChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Demographics Distribution -->
                                <div class="col-xl-4">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5 class="chart-title">Demographic Breakdown</h5>
                                        </div>
                                        <div class="chart-body">
                                            <canvas id="demographicChart" style="height: 400px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Network Analysis Section -->
                <section id="network-section" class="content-section">
                    <div class="row g-3">
                        <!-- Organization Network -->
                        <div class="col-xl-8">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5 class="chart-title">Organization Similarity Network</h5>
                                    <div class="chart-controls">
                                        <small class="text-muted">Cultural Similarity Connections</small>
                                    </div>
                                </div>
                                <div class="chart-body">
                                    <div id="networkChart" style="height: 500px;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Network Statistics -->
                        <div class="col-xl-4">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5 class="chart-title">Network Statistics</h5>
                                </div>
                                <div class="chart-body">
                                    <div id="networkStats">
                                        <div class="stat-item">
                                            <span class="stat-label">Total Organizations</span>
                                            <span class="stat-value" id="totalOrgs">--</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Network Connections</span>
                                            <span class="stat-value" id="totalConnections">--</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Average Similarity</span>
                                            <span class="stat-value" id="avgSimilarity">--</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Network Density</span>
                                            <span class="stat-value" id="networkDensity">--</span>
                                        </div>
                                        <div class="mt-3">
                                            <h6 class="mb-2">Top Similar Org Pairs</h6>
                                            <div id="topPairs" class="small text-muted"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Domain Flow Analysis -->
                        <div class="col-12">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5 class="chart-title">Domain → Organization → Department Flow</h5>
                                    <div class="chart-controls">
                                        <div class="d-flex gap-2 align-items-center">
                                            <label class="form-label m-0 me-1"><small>Domain</small></label>
                                            <select class="form-select form-select-sm" id="flowDomain" style="width: 180px;">
                                                <option value="all" selected>All Domains</option>
                                            </select>
                                            <label class="form-label m-0 ms-2 me-1"><small>Min Count</small></label>
                                            <select class="form-select form-select-sm" id="flowMinCount" style="width: 110px;">
                                                <option value="3">3+</option>
                                                <option value="5" selected>5+</option>
                                                <option value="10">10+</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-body">
                                    <div id="sankeyChart" class="w-100">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <canvas id="domainOrgFlowChart" style="height: 360px;"></canvas>
                                            </div>
                                            <div class="col-md-6">
                                                <canvas id="orgDeptFlowChart" style="height: 360px;"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Executive Summary -->
                        <div class="col-12">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5 class="chart-title">Executive Summary Dashboard</h5>
                                </div>
                                <div class="chart-body">
                                    <div class="row" id="executiveSummary">
                                        <div class="col-md-3">
                                            <div class="summary-metric">
                                                <h3 id="totalResponses">49.5K</h3>
                                                <p>Total Responses</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="summary-metric">
                                                <h3 id="avgCultureScore">2.53</h3>
                                                <p>Average Culture Score</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="summary-metric">
                                                <h3 id="worstSection">Mental Health</h3>
                                                <p>Priority Area</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="summary-metric">
                                                <h3 id="topDomain">Healthcare</h3>
                                                <p>Leading Domain</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js with local fallback -->
    <script src="/static/chart.min.js"
            onerror="this.onerror=null; this.src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js'"></script>

    <!-- Plotly.js for advanced visualizations -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Chart.js zoom plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>

    <!-- Safety: hide overlay even if main script fails -->
    <script>
        window.addEventListener('DOMContentLoaded', function(){
            setTimeout(function(){
                var overlay = document.getElementById('loadingOverlay');
                if (overlay) { overlay.classList.add('hidden'); overlay.style.display = 'none'; }
            }, 3000);
        });
    </script>
    <!-- Dashboard JavaScript -->
    <script src="/static/dashboard.js"></script>
</body>
</html>
